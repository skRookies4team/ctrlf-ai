# CTRL+F AI Gateway

CTRL+F ?„ë¡œ?íŠ¸??AI Gateway ?œë¹„?¤ì…?ˆë‹¤.
FastAPI ê¸°ë°˜?¼ë¡œ RAG, LLM, ë²¡í„° ê²€?? êµìœ¡ ?ìƒ ?ë™ ?ì„± ê¸°ëŠ¥???œê³µ?©ë‹ˆ??

## ì£¼ìš” ê¸°ëŠ¥

- **AI ì±„íŒ…**: ?¬ê·œ/?•ì±…, êµìœ¡, HR ê´€??ì§ˆì˜?‘ë‹µ (RAG + LLM)
- **?¤íŠ¸ë¦¬ë° ?‘ë‹µ**: ?¤ì‹œê°?? í° ?¤íŠ¸ë¦¬ë° ì§€??
- **RAG ê²€??*: Milvus/RAGFlow ê¸°ë°˜ ë¬¸ì„œ ê²€??
- **êµìœ¡ ?ìƒ ?ì„±**: ?¤í¬ë¦½íŠ¸ ?ì„± ??TTS ???ìƒ ?Œë”ë§??Œì´?„ë¼??
- **FAQ/?´ì¦ˆ ?ì„±**: ë¬¸ì„œ ê¸°ë°˜ FAQ, ?´ì¦ˆ ?ë™ ?ì„±
- **PII ë§ˆìŠ¤??*: ê°œì¸?•ë³´ ?ë™ ?ì? ë°?ë§ˆìŠ¤??
- **?˜ë„ ë¶„ë¥˜**: ?¬ìš©??ì§ˆë¬¸ ?˜ë„ ë¶„ë¥˜ ë°??¼ìš°??

## ?°ë™ ?œë¹„??

| ?œë¹„??         | ì£¼ì†Œ                  | ?¤ëª…                      |
| --------------- | --------------------- | ------------------------- |
| **vLLM**        | `your-llm-server:port`  | LLM (Qwen2.5-7B-Instruct) |
| **Embedding**   | `your-embedding-server:port`  | ?„ë² ??(ko-sroberta)      |
| **Milvus**      | `your-milvus-host:19540` | ë²¡í„° DB                   |
| **RAGFlow**     | `localhost:9380`      | RAG ?Œì´?„ë¼??           |
| **ctrlf-back**  | Spring                | ë°±ì—”??API                |
| **ctrlf-front** | React                 | ?„ë¡ ?¸ì—”??               |

## ë¹ ë¥¸ ?œì‘

### 1. ?˜ê²½ ?¤ì •

# ê°€?í™˜ê²??ì„± ë°??œì„±??

python -m venv venv
.\venv\Scripts\activate

```bash
source venv/Scripts/activate

# Python 3.12+ ê¶Œì¥
pip install -r requirements.txt

# ?˜ê²½ë³€???¤ì •
cp .env.example .env
# .env ?Œì¼?ì„œ ?œë¹„??URL ?˜ì •
```

### 2. ?œë²„ ?¤í–‰

```bash
# ê°œë°œ ëª¨ë“œ
uvicorn app.main:app --reload --port 8000

# ?„ë¡œ?•ì…˜ ëª¨ë“œ
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 3. ?•ì¸

```bash
# ?¬ìŠ¤ì²´í¬
curl http://localhost:8000/health

# API ë¬¸ì„œ (ë¸Œë¼?°ì?)
http://localhost:8000/docs
```

## ì±„íŒ… ?ŒìŠ¤??

### CLI ?„êµ¬ (ê¶Œì¥)

`chat_cli.py`???¤ì œ ?œë¹„??vLLM, Milvus, RAGFlow)ë¥??¬ìš©?˜ì—¬ ì±—ë´‡???ŒìŠ¤?¸í•©?ˆë‹¤.

```
chat_cli.py ??localhost:8000 (FastAPI) ???¤ì œ ?œë¹„?¤ë“¤
                                         ?œâ??€ vLLM (LLM ?‘ë‹µ ?ì„±)
                                         ?œâ??€ Milvus (ë²¡í„° ê²€??
                                         ?”â??€ RAGFlow (RAG ?Œì´?„ë¼??
```

**?¬ìš© ë°©ë²•:**

```bash
# 1. ?œë²„ ?¤í–‰ (?°ë???1)
uvicorn app.main:app --reload --port 8000

# 2. CLI ?ŒìŠ¤??(?°ë???2)
python chat_cli.py
```

**?¤í–‰ ?ˆì‹œ:**

```
==================================================
CTRL+F AI ì±„íŒ… ?ŒìŠ¤??(ì¢…ë£Œ: q ?ëŠ” Ctrl+C)
==================================================

ì§ˆë¬¸> ?°ì°¨?´ê? ê·œì • ?Œë ¤ì¤?
?‘ë‹µ ?€ê¸°ì¤‘...

?°ì°¨?´ê???ê·¼ë¡œê¸°ì?ë²•ì— ?°ë¼...

(RAG_INTERNAL | 3500ms)

ì§ˆë¬¸> q
ì¢…ë£Œ?©ë‹ˆ??
```

> **ì°¸ê³ **: `.env`??`AI_ENV=real` ?¤ì • ???¤ì œ ?œë¹„???°ë™, `AI_ENV=mock` ?¤ì • ??Mock ?‘ë‹µ

**?„ìˆ˜ ?œë¹„??**

| ?˜ê²½ë³€??              | RAGFlow | Milvus | vLLM | ?¤ëª…                    |
| ---------------------- | ------- | ------ | ---- | ----------------------- |
| `MILVUS_ENABLED=true`  | ë¶ˆí•„?? | ?„ìˆ˜   | ?„ìˆ˜ | Milvus ì§ì ‘ ?°ë™ (ê¶Œì¥) |
| `MILVUS_ENABLED=false` | ?„ìˆ˜    | ë¶ˆí•„??| ?„ìˆ˜ | RAGFlow ?Œì´?„ë¼???¬ìš© |

- **vLLM**: ??ƒ ?„ìˆ˜ (LLM ?‘ë‹µ ?ì„±, ?„ë² ??
- **RAGFlow ?†ì´ ?ŒìŠ¤??*: `MILVUS_ENABLED=true` ?¤ì • ??Milvusë§??°ê²°?˜ë©´ ??
- **ëª¨ë“  ?œë¹„???†ì´ ?ŒìŠ¤??*: `AI_ENV=mock` ?¤ì • ??Mock ?‘ë‹µ ë°˜í™˜

### curl

```bash
curl -X POST http://localhost:8000/ai/chat/messages \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test",
    "user_id": "user1",
    "user_role": "EMPLOYEE",
    "domain": "POLICY",
    "messages": [{"role": "user", "content": "?°ì°¨?´ê? ê·œì • ?Œë ¤ì¤?}]
  }'
```

## API ?”ë“œ?¬ì¸??

### ì±„íŒ…

| ë©”ì„œ??| ê²½ë¡œ                | ?¤ëª…          |
| ------ | ------------------- | ------------- |
| POST   | `/ai/chat/messages` | AI ì±„íŒ…       |
| POST   | `/ai/chat/stream`   | ?¤íŠ¸ë¦¬ë° ì±„íŒ… |

### êµìœ¡ ?ìƒ ?ì„±

| ë©”ì„œ??| ê²½ë¡œ                           | ?¤ëª…             |
| ------ | ------------------------------ | ---------------- |
| POST   | `/api/scripts`                 | ?¤í¬ë¦½íŠ¸ ?ì„±    |
| GET    | `/api/scripts/{id}`            | ?¤í¬ë¦½íŠ¸ ì¡°íšŒ    |
| POST   | `/api/scripts/{id}/approve`    | ?¤í¬ë¦½íŠ¸ ?¹ì¸    |
| POST   | `/api/videos/{id}/render-jobs` | ?ìƒ ?Œë”ë§??œì‘ |
| GET    | `/api/render-jobs/{id}`        | ?Œë”ë§??íƒœ ì¡°íšŒ |

### FAQ/?´ì¦ˆ

| ë©”ì„œ??| ê²½ë¡œ                | ?¤ëª…      |
| ------ | ------------------- | --------- |
| POST   | `/ai/faq/generate`  | FAQ ?ì„±  |
| POST   | `/ai/quiz/generate` | ?´ì¦ˆ ?ì„± |

### Internal RAG (ë°±ì—”???°ë™)

| ë©”ì„œ??| ê²½ë¡œ                     | ?¤ëª…           |
| ------ | ------------------------ | -------------- |
| POST   | `/internal/rag/index`    | ë¬¸ì„œ ?¸ë±??   |
| POST   | `/internal/rag/delete`   | ë¬¸ì„œ ?? œ      |
| GET    | `/internal/jobs/{jobId}` | ?‘ì—… ?íƒœ ì¡°íšŒ |

## ?˜ê²½ë³€??(.env)

```env
# AI ?˜ê²½ (mock / real)
AI_ENV=real

# LLM ?œë²„ (vLLM - ì±„íŒ… + ?„ë² ???µí•©)
LLM_BASE_URL=http://your-llm-server:port
LLM_MODEL_NAME=Qwen/Qwen2.5-7B-Instruct
EMBEDDING_MODEL_NAME=BAAI/bge-m3

# Milvus (MILVUS_ENABLED=trueë©?RAGFlow ?€??Milvus ì§ì ‘ ?¬ìš©)
MILVUS_ENABLED=true
MILVUS_HOST=your-milvus-host
MILVUS_PORT=19530
MILVUS_COLLECTION_NAME=ragflow_chunks

# RAGFlow (MILVUS_ENABLED=false?????¬ìš©)
RAGFLOW_BASE_URL=http://localhost:9380
RAGFLOW_API_KEY=your-api-key

# TTS (mock / gtts / polly / gcp)
TTS_PROVIDER=gtts

# Storage (local / s3 / backend_presigned)
STORAGE_PROVIDER=local
```

## ?ŒìŠ¤??

```bash
# ?„ì²´ ?ŒìŠ¤??
pytest

# ?ì„¸ ì¶œë ¥
pytest -v

# ?¹ì • ?ŒìŠ¤??
pytest tests/test_internal_rag.py -v
```

## ?„ë¡œ?íŠ¸ êµ¬ì¡°

```
ctrlf-ai/
?œâ??€ app/
??  ?œâ??€ main.py                 # FastAPI ì§„ì…??
??  ?œâ??€ api/v1/                 # API ?”ë“œ?¬ì¸??
??  ?œâ??€ clients/                # ?¸ë? ?œë¹„???´ë¼?´ì–¸??
??  ?œâ??€ services/               # ë¹„ì¦ˆ?ˆìŠ¤ ë¡œì§
??  ?œâ??€ models/                 # Pydantic ëª¨ë¸
??  ?”â??€ core/                   # ?¤ì •, ë¡œê¹…
?œâ??€ tests/                      # ?ŒìŠ¤??
?œâ??€ docs/                       # ê°œë°œ ë¬¸ì„œ
?œâ??€ chat_cli.py                 # ì±„íŒ… CLI ?„êµ¬
?œâ??€ requirements.txt
?”â??€ .env
```

## ?„í‚¤?ì²˜

```
?Œâ??€?€?€?€?€?€?€?€?€?€?€?€??    ?Œâ??€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€??
?? Frontend   ?‚â??€?€?€?¶â”‚         AI Gateway (FastAPI)        ??
?? (React)    ??    ??                                    ??
?”â??€?€?€?€?€?€?€?€?€?€?€?€??    ?? ?Œâ??€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€??   ??
                    ?? ??    Router Orchestrator      ??   ??
?Œâ??€?€?€?€?€?€?€?€?€?€?€?€??    ?? ?? (Rule Router + LLM Router)  ??   ??
?? Backend    ?‚â??€?€?€?¶â”‚  ?”â??€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€??   ??
?? (Spring)   ??    ??               ??                   ??
?”â??€?€?€?€?€?€?€?€?€?€?€?€??    ?? ?Œâ??€?€?€?€?€?€?€?€?€?€?€?€?¼â??€?€?€?€?€?€?€?€?€?€?€?€??     ??
                    ?? ??     Chat / Video Service  ??     ??
                    ?? ?? (RAG, LLM, TTS, Render)   ??     ??
                    ?? ?”â??€?€?€?€?€?€?€?€?€?€?€?€?¬â??€?€?€?€?€?€?€?€?€?€?€?€??     ??
                    ?”â??€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?¼â??€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?€??
                                     ??
                    ?Œâ??€?€?€?€?€?€?€?€?€?€?€?€?€?€?€?¼â??€?€?€?€?€?€?€?€?€?€?€?€?€?€?€??
                    ??               ??               ??
              ?Œâ??€?€?€?€?€?€?€?€?€??   ?Œâ??€?€?€?€?€?€?€?€?€??   ?Œâ??€?€?€?€?€?€?€?€?€??
              ?? Milvus  ??   ??  vLLM   ??   ??Embedding??
              ??(Vector) ??   ?? (Chat)  ??   ??ko-sbert)??
              ?”â??€?€?€?€?€?€?€?€?€??   ?”â??€?€?€?€?€?€?€?€?€??   ?”â??€?€?€?€?€?€?€?€?€??
```

## ê°œë°œ ?ˆìŠ¤? ë¦¬

### ?ìƒ ?ì„± ?Œì´?„ë¼??

- **Phase 37**: Ken Burns + Fade ?¨ê³¼
- **Phase 36**: Presigned ?…ë¡œ??
- **Phase 33-35**: Render Job ?´ì˜??
- **Phase 29-32**: KB Index, Script Gen, Video Rendering

### RAG/ì±„íŒ…

- **Phase 25**: Internal RAG (Milvus ì§ì ‘ ?°ë™)
- **Phase 24**: Milvus ë²¡í„° ê²€??
- **Phase 22-23**: Router Orchestrator, ê°œì¸??
- **Phase 10-12**: ??• Ã—?„ë©”???¼ìš°?? Fallback

## ?¼ì´? ìŠ¤

Private - CTRL+F Team
