# CTRLF AI ì˜ìƒ ì œì‘ íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜

> ì‹¤ì œ ì½”ë“œ ë¶„ì„ ê¸°ë°˜ ê¸°ìˆ  ë¬¸ì„œ
> ì‘ì„±ì¼: 2025-12-31
> ë²„ì „: Phase 42 ê¸°ì¤€

---

## ëª©ì°¨

1. [ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”](#1-ì „ì²´-ì•„í‚¤í…ì²˜-ê°œìš”)
2. [Phase 1: ìŠ¤í¬ë¦½íŠ¸ ìƒì„± íŒŒì´í”„ë¼ì¸](#2-phase-1-ìŠ¤í¬ë¦½íŠ¸-ìƒì„±-íŒŒì´í”„ë¼ì¸)
3. [Phase 2: ì˜ìƒ ë Œë”ë§ íŒŒì´í”„ë¼ì¸ (7-Step)](#3-phase-2-ì˜ìƒ-ë Œë”ë§-íŒŒì´í”„ë¼ì¸-7-step)
4. [ë°ì´í„° ë³€í™˜ ìƒì„¸ ë¶„ì„](#4-ë°ì´í„°-ë³€í™˜-ìƒì„¸-ë¶„ì„)
5. [ì™¸ë¶€ ì„œë¹„ìŠ¤ í†µí•©](#5-ì™¸ë¶€-ì„œë¹„ìŠ¤-í†µí•©)
6. [API ì—”ë“œí¬ì¸íŠ¸ ë° ìš”ì²­ íë¦„](#6-api-ì—”ë“œí¬ì¸íŠ¸-ë°-ìš”ì²­-íë¦„)
7. [WebSocket ì‹¤ì‹œê°„ ì§„í–‰ë¥ ](#7-websocket-ì‹¤ì‹œê°„-ì§„í–‰ë¥ )
8. [ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬](#8-ì—ëŸ¬-ì²˜ë¦¬-ë°-ë³µêµ¬)
9. [í™˜ê²½ ì„¤ì •](#9-í™˜ê²½-ì„¤ì •)
10. [ì£¼ìš” íŒŒì¼ ìœ„ì¹˜](#10-ì£¼ìš”-íŒŒì¼-ìœ„ì¹˜)

---

## 1. ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

### 1.1 ì‹œìŠ¤í…œ êµ¬ì„±ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CTRLF AI Video Pipeline                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Phase 1: ìŠ¤í¬ë¦½íŠ¸   â”‚         â”‚          Phase 2: ì˜ìƒ ë Œë”ë§             â”‚ â”‚
â”‚  â”‚      ìƒì„±             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                      â”‚                              â”‚
â”‚           â–¼                                      â–¼                              â”‚
â”‚   LLM (Qwen2.5-7B)                    7-Step Rendering Pipeline                â”‚
â”‚           â”‚                                      â”‚                              â”‚
â”‚           â–¼                                      â–¼                              â”‚
â”‚   VideoScript JSON              TTS â†’ FFmpeg â†’ Storage â†’ Callback              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Two-Phase ë¹„ë™ê¸° íŒŒì´í”„ë¼ì¸

```
Phase 1: Script Generation          Phase 2: Video Rendering
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM-based Script Gen    â”‚         â”‚ Multi-step Rendering Job     â”‚
â”‚ (VideoScriptGeneration) â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ (RenderJobRunner)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                    â†“
  LLM_Client.generate                RenderStep Pipeline:
  (OpenAI-compatible)                 1. VALIDATE_SCRIPT
  â†“                                   2. GENERATE_TTS
  Returns raw_json with               3. GENERATE_SUBTITLE
  chapters/scenes structure            4. RENDER_SLIDES
                                       5. COMPOSE_VIDEO
                                       6. UPLOAD_ASSETS
                                       7. FINALIZE
```

---

## 2. Phase 1: ìŠ¤í¬ë¦½íŠ¸ ìƒì„± íŒŒì´í”„ë¼ì¸

### 2.1 íë¦„ë„

```
POST /api/videos/{video_id}/scripts/generate
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  VideoScriptGenerationService â”‚  (video_script_generation_service.py)
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  â€¢ source_text (êµìœ¡ ì›ë¬¸)     â”‚
    â”‚  â€¢ target_minutes (ê¸°ë³¸: 3ë¶„)  â”‚
    â”‚  â€¢ max_chapters (ê¸°ë³¸: 5)      â”‚
    â”‚  â€¢ style (friendly_security)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         LLM Client            â”‚  (llm_client.py)
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  OpenAI-compatible API        â”‚
    â”‚  Temperature: 0.3             â”‚
    â”‚  Max Tokens: 4096             â”‚
    â”‚  Auto-retry: 2íšŒ              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    VideoScript JSON ì¶œë ¥       â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  {                            â”‚
    â”‚    chapters: [                â”‚
    â”‚      {                        â”‚
    â”‚        chapter_id, title,     â”‚
    â”‚        scenes: [              â”‚
    â”‚          {                    â”‚
    â”‚            scene_id,          â”‚
    â”‚            narration,    â—„â”€â”€â”€ TTSìš© í…ìŠ¤íŠ¸
    â”‚            on_screen_text,â—„â”€â”€ ìë§‰ìš© í…ìŠ¤íŠ¸
    â”‚            duration_sec       â”‚
    â”‚          }                    â”‚
    â”‚        ]                      â”‚
    â”‚      }                        â”‚
    â”‚    ]                          â”‚
    â”‚  }                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         [Backend Callback]
    POST /video/script/complete
```

### 2.2 VideoScriptGenerationService ìƒì„¸

**ìœ„ì¹˜**: `app/services/video_script_generation_service.py`

**ì£¼ìš” ê¸°ëŠ¥**:

- êµìœ¡ ì›ë¬¸ â†’ VideoScript JSON ë³€í™˜ (LLM í˜¸ì¶œ)
- JSON íŒŒì‹± + Pydantic ìŠ¤í‚¤ë§ˆ ê²€ì¦
- ì‹¤íŒ¨ ì‹œ ìë™ ë³µêµ¬ (ìµœëŒ€ 2íšŒ ì¬ì‹œë„)

**ì…ë ¥ ì˜µì…˜** (`ScriptGenerationOptions`):

| ì˜µì…˜                     | ê¸°ë³¸ê°’                         | ì„¤ëª…                |
| ------------------------ | ------------------------------ | ------------------- |
| `language`               | `"ko"`                         | ì–¸ì–´ ì½”ë“œ           |
| `target_minutes`         | `3`                            | ëª©í‘œ ì˜ìƒ ê¸¸ì´ (ë¶„) |
| `max_chapters`           | `5`                            | ìµœëŒ€ ì±•í„° ìˆ˜        |
| `max_scenes_per_chapter` | `6`                            | ì±•í„°ë‹¹ ìµœëŒ€ ì”¬ ìˆ˜   |
| `style`                  | `"friendly_security_training"` | ìŠ¤í¬ë¦½íŠ¸ ìŠ¤íƒ€ì¼     |

### 2.3 Pydantic ìŠ¤í‚¤ë§ˆ

```python
class VideoScriptSchema(BaseModel):
    chapters: List[ChapterSchema]  # min_length=1

class ChapterSchema(BaseModel):
    chapter_id: int
    title: str                     # min_length=1
    scenes: List[SceneSchema]      # min_length=1

class SceneSchema(BaseModel):
    scene_id: int
    narration: str                 # min_length=1, TTS ì…ë ¥
    on_screen_text: Optional[str]  # í™”ë©´ ìë§‰
    duration_sec: Optional[float]  # ge=0
```

---

## 3. Phase 2: ì˜ìƒ ë Œë”ë§ íŒŒì´í”„ë¼ì¸ (7-Step)

### 3.1 ì „ì²´ íë¦„ë„

```
POST /api/videos/{video_id}/render-jobs
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    RenderJobRunner                              â”‚
    â”‚                    (render_job_runner.py)                       â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  â€¢ ì¤‘ë³µ Job ë°©ì§€ (idempotency check)                            â”‚
    â”‚  â€¢ DB ìƒíƒœ ê´€ë¦¬ (QUEUED â†’ PROCESSING â†’ COMPLETED/FAILED)        â”‚
    â”‚  â€¢ WebSocket ì§„í–‰ë¥  ë¸Œë¡œë“œìºìŠ¤íŠ¸                                  â”‚
    â”‚  â€¢ render_spec_json ìŠ¤ëƒ…ìƒ· ì €ì¥ (Phase 38)                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   RealVideoRenderer                             â”‚
    â”‚                   (video_renderer_real.py)                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    7-Step Pipeline                     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                        â”‚
        â”‚  Step 1: VALIDATE_SCRIPT                               â”‚
        â”‚  â””â”€ RenderSpecì—ì„œ SceneInfo[] ì¶”ì¶œ                     â”‚
        â”‚                    â”‚                                   â”‚
        â”‚                    â–¼                                   â”‚
        â”‚  Step 2: GENERATE_TTS                                  â”‚
        â”‚  â”œâ”€ ëª¨ë“  narration ì—°ê²°                                 â”‚
        â”‚  â””â”€ TTS Provider â†’ MP3                                 â”‚
        â”‚                    â”‚                                   â”‚
        â”‚                    â–¼                                   â”‚
        â”‚  Step 3: GENERATE_SUBTITLE                             â”‚
        â”‚  â””â”€ SRT ìë§‰ íŒŒì¼ ìƒì„±                                   â”‚
        â”‚                    â”‚                                   â”‚
        â”‚                    â–¼                                   â”‚
        â”‚  Step 4: RENDER_SLIDES                                 â”‚
        â”‚  â”œâ”€ Basic: ë‹¨ìƒ‰ ë°°ê²½                                    â”‚
        â”‚  â””â”€ Animated: VisualPlanExtractor + ImageAssetService  â”‚
        â”‚                    â”‚                                   â”‚
        â”‚                    â–¼                                   â”‚
        â”‚  Step 5: COMPOSE_VIDEO                                 â”‚
        â”‚  â”œâ”€ VideoComposer (video_composer.py)                  â”‚
        â”‚  â”œâ”€ FFmpeg: ì´ë¯¸ì§€ + ì˜¤ë””ì˜¤ â†’ MP4                        â”‚
        â”‚  â”œâ”€ 1280Ã—720 @ 24fps                                   â”‚
        â”‚  â””â”€ Ken Burns effect (animated mode)                   â”‚
        â”‚                    â”‚                                   â”‚
        â”‚                    â–¼                                   â”‚
        â”‚  Step 6: UPLOAD_ASSETS                                 â”‚
        â”‚  â”œâ”€ StorageAdapter (storage_adapter.py)                â”‚
        â”‚  â””â”€ S3: videos/{video_id}/{script_id}/{job_id}/        â”‚
        â”‚                    â”‚                                   â”‚
        â”‚                    â–¼                                   â”‚
        â”‚  Step 7: FINALIZE                                      â”‚
        â”‚  â”œâ”€ Job ìƒíƒœ â†’ COMPLETED                                â”‚
        â”‚  â””â”€ Backend Callback (ë¹„ë™ê¸°)                           â”‚
        â”‚                                                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ê° ë‹¨ê³„ë³„ ìƒì„¸

#### Step 1: VALIDATE_SCRIPT (0% â†’ 15%)

- **ì„œë¹„ìŠ¤**: `RealVideoRenderer._validate_script()`
- **ì…ë ¥**: `script_json` (Dict)
- **ì¶œë ¥**: `List[SceneInfo]` (í‰íƒ„í™”ëœ ì”¬ ë¦¬ìŠ¤íŠ¸)
- **ë™ì‘**: chapters/scenes ì¤‘ì²© êµ¬ì¡°ë¥¼ SceneInfo ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜

#### Step 2: GENERATE_TTS (15% â†’ 40%)

- **ì„œë¹„ìŠ¤**: `RealVideoRenderer._generate_tts()`
- **ì…ë ¥**: ëª¨ë“  ì”¬ì˜ narration í…ìŠ¤íŠ¸ ì—°ê²°
- **ì¶œë ¥**: MP3 ì˜¤ë””ì˜¤ íŒŒì¼
- **TTS Provider**: Mock, gTTS, AWS Polly, GCP Cloud TTS

#### Step 3: GENERATE_SUBTITLE (40% â†’ 50%)

- **ì„œë¹„ìŠ¤**: `VideoComposer._generate_srt()`
- **ì…ë ¥**: `List[SceneInfo]` + duration ì •ë³´
- **ì¶œë ¥**: SRT ìë§‰ íŒŒì¼

#### Step 4: RENDER_SLIDES (50% â†’ 60%)

- **ì„œë¹„ìŠ¤**: `RealVideoRenderer._render_slides()`
- **Basic ëª¨ë“œ**: ìŠ¤í‚µ (FFmpegì—ì„œ ë‹¨ìƒ‰ ë°°ê²½ ì²˜ë¦¬)
- **Animated ëª¨ë“œ**:
  - `VisualPlanExtractor` â†’ ì‹œê°ì  ê³„íš ì¶”ì¶œ
  - `ImageAssetService` â†’ ì”¬ë³„ ì´ë¯¸ì§€ ìƒì„±

#### Step 5: COMPOSE_VIDEO (60% â†’ 85%)

- **ì„œë¹„ìŠ¤**: `VideoComposer.compose()`
- **ì…ë ¥**: scenes + audio + images
- **ì¶œë ¥**: MP4 ë¹„ë””ì˜¤ + SRT ìë§‰ + JPG ì¸ë„¤ì¼
- **FFmpeg ì„¤ì •**:
  - í•´ìƒë„: 1280Ã—720
  - FPS: 24
  - ì½”ë±: H.264 (libx264)
  - ë¹„íŠ¸ë ˆì´íŠ¸: 2Mbps
  - Animated: Ken Burns zoom + fade ì „í™˜

#### Step 6: UPLOAD_ASSETS (85% â†’ 95%)

- **ì„œë¹„ìŠ¤**: `RealVideoRenderer._upload_assets()`
- **Storage Provider**: Local, S3, MinIO, Backend Presigned
- **Object Key ê·œì¹™**: `videos/{video_id}/{script_id}/{job_id}/`

#### Step 7: FINALIZE (95% â†’ 100%)

- **ë™ì‘**:
  1. DBì— assets ì €ì¥
  2. Job ìƒíƒœ â†’ COMPLETED
  3. WebSocket ì™„ë£Œ ì•Œë¦¼
  4. Backend callback (ë¹„ë™ê¸°)

### 3.3 ìƒíƒœ ì „ì´ ë‹¤ì´ì–´ê·¸ë¨

```
              create_job()
                   â”‚
                   â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  QUEUED  â”‚
             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                  â”‚ start_job() / _execute_job()
                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ PROCESSING â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
                 â”‚                      â”‚ retry_job()
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚        â”‚        â”‚             â”‚
        â–¼        â”‚        â–¼             â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
   â”‚COMPLETED â”‚  â”‚   â”‚ FAILED â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚        â”‚
                 â”‚        â”‚ error_code:
                 â”‚        â”‚ â€¢ STORAGE_UPLOAD_FAILED
                 â”‚        â”‚ â€¢ CANCELED
                 â”‚        â”‚ â€¢ (ê¸°íƒ€ ì—ëŸ¬)
                 â–¼
          cancel_job()
```

---

## 4. ë°ì´í„° ë³€í™˜ ìƒì„¸ ë¶„ì„

### 4.1 Phase 1: ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ë°ì´í„° íë¦„

````
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 1: ì‚¬ìš©ì ì…ë ¥                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  source_text: str                                                   â”‚
â”‚  "í”¼ì‹± ê³µê²©ì€ ì‚¬íšŒê³µí•™ì  ê¸°ë²•ì„ í™œìš©í•œ ì‚¬ì´ë²„ ê³µê²©ì˜ ì¼ì¢…ìœ¼ë¡œ..."     â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“ í¬ê¸°: ì•½ 500~5,000ì                                             â”‚
â”‚  ğŸ“¦ í˜•íƒœ: plain text                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 2: LLM í”„ë¡¬í”„íŠ¸ êµ¬ì„±                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  messages = [                                                       â”‚
â”‚    {"role": "system", "content": "ë‹¹ì‹ ì€ êµìœ¡ ì˜ìƒ ìŠ¤í¬ë¦½íŠ¸..."},    â”‚
â”‚    {"role": "user", "content": "ì•„ë˜ êµìœ¡ ì›ë¬¸ì„ ë¶„ì„í•˜ì—¬..."}       â”‚
â”‚  ]                                                                  â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“ í¬ê¸°: system(~800) + user(~300 + source) â‰ˆ 1,100 + source_text  â”‚
â”‚  ğŸ“¦ í˜•íƒœ: List[Dict] - OpenAI ë©”ì‹œì§€ í¬ë§·                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 3: LLM í˜¸ì¶œ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POST {LLM_BASE_URL}/v1/chat/completions                            â”‚
â”‚  {                                                                  â”‚
â”‚    "model": "meta-llama/Meta-Llama-3-8B-Instruct",                             â”‚
â”‚    "messages": [...],                                               â”‚
â”‚    "temperature": 0.3,                                              â”‚
â”‚    "max_tokens": 4096                                               â”‚
â”‚  }                                                                  â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“ Request: ~6KB                                                   â”‚
â”‚  â±ï¸ Timeout: 30ì´ˆ                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 4: LLM ì‘ë‹µ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  raw_output: str (JSON í˜•ì‹)                                        â”‚
â”‚  ```json                                                            â”‚
â”‚  {                                                                  â”‚
â”‚    "chapters": [                                                    â”‚
â”‚      { "chapter_id": 1, "title": "...", "scenes": [...] }           â”‚
â”‚    ]                                                                â”‚
â”‚  }                                                                  â”‚
â”‚  ```                                                                â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“ í¬ê¸°: ~2,000~10,000ì                                            â”‚
â”‚  ğŸ“¦ í˜•íƒœ: str (JSON ë¬¸ìì—´)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 5: JSON íŒŒì‹± + ê²€ì¦                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. _extract_json(): ì½”ë“œë¸”ë¡ì—ì„œ JSON ì¶”ì¶œ                          â”‚
â”‚  2. json.loads(): str â†’ Dict                                        â”‚
â”‚  3. VideoScriptSchema.model_validate(): Pydantic ê²€ì¦               â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“¦ í˜•íƒœ: str â†’ Dict[str, Any]                                       â”‚
â”‚  ğŸ”„ ì‹¤íŒ¨ ì‹œ: ìµœëŒ€ 2íšŒ ì¬ì‹œë„ (fix prompt)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 6: ìµœì¢… ì¶œë ¥                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  raw_json: Dict[str, Any]                                           â”‚
â”‚  {                                                                  â”‚
â”‚    "chapters": [                                                    â”‚
â”‚      {                                                              â”‚
â”‚        "chapter_id": 1,                                             â”‚
â”‚        "title": "í”¼ì‹± ê³µê²©ì´ë€?",                                    â”‚
â”‚        "scenes": [                                                  â”‚
â”‚          {                                                          â”‚
â”‚            "scene_id": 1,                                           â”‚
â”‚            "narration": "ì•ˆë…•í•˜ì„¸ìš”...",                             â”‚
â”‚            "on_screen_text": "í”¼ì‹± ê³µê²©ì˜ ì •ì˜",                     â”‚
â”‚            "duration_sec": 15.0                                     â”‚
â”‚          }                                                          â”‚
â”‚        ]                                                            â”‚
â”‚      }                                                              â”‚
â”‚    ]                                                                â”‚
â”‚  }                                                                  â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“ í¬ê¸°: ~5KB                                                       â”‚
â”‚  ğŸ“Š êµ¬ì¡°: 2-3 ì±•í„° Ã— 3-6 ì”¬ = 10-18ê°œ ì”¬                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
````

### 4.2 Phase 2: ì˜ìƒ ë Œë”ë§ ë°ì´í„° íë¦„

#### Step 1: VALIDATE_SCRIPT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì…ë ¥: script_json (Dict)                                           â”‚
â”‚  ğŸ“ ~5KB                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  _extract_scenes() ë³€í™˜                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì¶œë ¥: List[SceneInfo]                                              â”‚
â”‚  [                                                                  â”‚
â”‚    SceneInfo(                                                       â”‚
â”‚      scene_id=1,                                                    â”‚
â”‚      narration="ì•ˆë…•í•˜ì„¸ìš”...",                                      â”‚
â”‚      caption="í”¼ì‹± ê³µê²©ì˜ ì •ì˜",                                     â”‚
â”‚      duration_sec=15.0,                                             â”‚
â”‚      image_path=None                                                â”‚
â”‚    ),                                                               â”‚
â”‚    ...                                                              â”‚
â”‚  ]                                                                  â”‚
â”‚  ğŸ“ ~3KB, ğŸ“Š 10-18ê°œ ê°ì²´                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 2: GENERATE_TTS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì…ë ¥: ëª¨ë“  narration ì—°ê²°                                           â”‚
â”‚  full_text = " ".join(scene.narration for scene in scenes)          â”‚
â”‚  ğŸ“ ~1,500-3,000ì (3ë¶„ ì˜ìƒ ê¸°ì¤€)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TTS Provider í˜¸ì¶œ                                                   â”‚
â”‚  â€¢ Mock: ë¬´ìŒ MP3                                                    â”‚
â”‚  â€¢ gTTS: Google TTS API                                             â”‚
â”‚  â€¢ Polly: AWS Voice "Seoyeon"                                       â”‚
â”‚  â€¢ GCP: Voice "ko-KR-Wavenet-A"                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì¶œë ¥: audio.mp3                                                     â”‚
â”‚  ğŸ“ ~500KB - 2MB (128kbps)                                          â”‚
â”‚  â±ï¸ ~180ì´ˆ (3ë¶„)                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 3-4: GENERATE_SUBTITLE & RENDER_SLIDES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBTITLE (SRT ìƒì„±)                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì…ë ¥: List[SceneInfo]                                              â”‚
â”‚  ì¶œë ¥: job-xxx.srt                                                   â”‚
â”‚                                                                     â”‚
â”‚  1                                                                  â”‚
â”‚  00:00:00,000 --> 00:00:15,000                                      â”‚
â”‚  í”¼ì‹± ê³µê²©ì˜ ì •ì˜                                                    â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“ ~1KB                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RENDER_SLIDES (Animated ëª¨ë“œë§Œ)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. VisualPlanExtractor â†’ VisualPlan                                â”‚
â”‚  2. ImageAssetService â†’ PNG ì´ë¯¸ì§€                                   â”‚
â”‚                                                                     â”‚
â”‚  ì¶œë ¥: scene_images/scene_0.png, scene_1.png, ...                   â”‚
â”‚  ğŸ“ ~150KB/ì”¬, ì´ ~2MB                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 5: COMPOSE_VIDEO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì…ë ¥                                                                â”‚
â”‚  â€¢ scenes: List[SceneInfo] (~3KB)                                   â”‚
â”‚  â€¢ audio: MP3 (~1.5MB)                                              â”‚
â”‚  â€¢ images: PNGÃ—N (~2MB, animated)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FFmpeg ì²˜ë¦¬                                                         â”‚
â”‚                                                                     â”‚
â”‚  BASIC ëª¨ë“œ:                                                         â”‚
â”‚  ffmpeg -f lavfi -i "color=c=0x1E1E1E:s=1280x720:d=180:r=24" \      â”‚
â”‚         -i audio.mp3 -vf "drawtext=..." \                           â”‚
â”‚         -c:v libx264 -preset medium -b:v 2M output.mp4              â”‚
â”‚                                                                     â”‚
â”‚  ANIMATED ëª¨ë“œ:                                                      â”‚
â”‚  ffmpeg -loop 1 -t 15 -i scene_0.png ... \                          â”‚
â”‚         -filter_complex "zoompan=...; xfade=fade:duration=0.5" \    â”‚
â”‚         output.mp4                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì¶œë ¥                                                                â”‚
â”‚  â€¢ video.mp4: ~25MB (H.264, 2Mbps)                                  â”‚
â”‚  â€¢ subtitles.srt: ~1KB                                              â”‚
â”‚  â€¢ thumb.jpg: ~50KB                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 6: UPLOAD_ASSETS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì—…ë¡œë“œ ëŒ€ìƒ                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ë¡œì»¬ íŒŒì¼              â†’    Object Key                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  job-xxx.mp4 (~25MB)    â†’    videos/{video_id}/{script_id}/         â”‚
â”‚                               {job_id}/video.mp4                    â”‚
â”‚                                                                     â”‚
â”‚  job-xxx.srt (~1KB)     â†’    videos/.../subtitles.srt               â”‚
â”‚                                                                     â”‚
â”‚  job-xxx_thumb.jpg      â†’    videos/.../thumb.jpg                   â”‚
â”‚  (~50KB)                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Storage Provider                                                    â”‚
â”‚  â€¢ LOCAL: ./data/assets/ â†’ /assets URL                              â”‚
â”‚  â€¢ S3: boto3.put_object â†’ S3 URL                                    â”‚
â”‚  â€¢ BACKEND_PRESIGNED: Presign â†’ PUT â†’ Complete                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì¶œë ¥: StorageResult                                                 â”‚
â”‚  {                                                                  â”‚
â”‚    key: "videos/.../video.mp4",                                     â”‚
â”‚    url: "https://cdn.example.com/.../video.mp4",                    â”‚
â”‚    size_bytes: 26214400,                                            â”‚
â”‚    content_type: "video/mp4"                                        â”‚
â”‚  }                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ë°ì´í„° í¬ê¸° ë³€í™˜ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ë°ì´í„° í¬ê¸° ë³€í™˜ íë¦„ (3ë¶„ ì˜ìƒ ê¸°ì¤€)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Phase 1: ìŠ¤í¬ë¦½íŠ¸ ìƒì„±                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                     â”‚
â”‚  source_text  â†’  LLM Prompt  â†’  raw_output  â†’  raw_json             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ~2 KB  â”‚  â†’  â”‚ ~6 KB   â”‚ â†’  â”‚ ~5 KB   â”‚ â†’  â”‚ ~5 KB   â”‚          â”‚
â”‚  â”‚ ë¬¸ìì—´  â”‚     â”‚messages â”‚    â”‚JSON str â”‚    â”‚ Dict    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                     â”‚
â”‚  Phase 2: ì˜ìƒ ë Œë”ë§                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                     â”‚
â”‚  raw_json  â†’  SceneInfo[]  â†’  TTS     â†’  Images  â†’  Video           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ~5 KB â”‚ â†’ â”‚ ~3 KB    â”‚ â†’ â”‚~1.5MB â”‚ â†’ â”‚ ~2MB â”‚ â†’ â”‚ ~25 MB â”‚      â”‚
â”‚  â”‚ Dict  â”‚   â”‚ 10-18ê°œ   â”‚   â”‚ MP3   â”‚   â”‚ PNG  â”‚   â”‚  MP4   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚  + SRT (~1KB) + Thumbnail (~50KB) â†’ Upload â†’ URLs                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 ê° ë‹¨ê³„ë³„ ë°ì´í„° í˜•íƒœ ìš”ì•½ í‘œ

| ë‹¨ê³„           | ì…ë ¥ í˜•íƒœ         | ì…ë ¥ í¬ê¸° | ì¶œë ¥ í˜•íƒœ         | ì¶œë ¥ í¬ê¸° |
| -------------- | ----------------- | --------- | ----------------- | --------- |
| source_text    | `str`             | ~2KB      | -                 | -         |
| LLM Prompt     | `List[Dict]`      | ~6KB      | -                 | -         |
| LLM Response   | -                 | -         | `str`             | ~5KB      |
| Pydantic ê²€ì¦  | `Dict`            | ~5KB      | `Dict`            | ~5KB      |
| SceneInfo ì¶”ì¶œ | `Dict`            | ~5KB      | `List[SceneInfo]` | ~3KB      |
| TTS í•©ì„±       | `str`             | ~2Kì     | `Binary (MP3)`    | ~1.5MB    |
| ì´ë¯¸ì§€ ìƒì„±    | `SceneInfo`       | ~200B/ì”¬  | `Binary (PNG)`    | ~150KB/ì”¬ |
| FFmpeg í•©ì„±    | MP3 + PNG         | ~3.5MB    | `Binary (MP4)`    | ~25MB     |
| ìë§‰ ìƒì„±      | `List[SceneInfo]` | ~3KB      | `Text (SRT)`      | ~1KB      |
| ì¸ë„¤ì¼ ì¶”ì¶œ    | MP4               | ~25MB     | `Binary (JPG)`    | ~50KB     |
| Storage ì—…ë¡œë“œ | Binary Files      | ~25MB     | `StorageResult`   | URLs      |

---

## 5. ì™¸ë¶€ ì„œë¹„ìŠ¤ í†µí•©

### 5.1 ì„œë¹„ìŠ¤ í†µí•© ë§µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        External Services                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   LLM       â”‚    â”‚    TTS      â”‚    â”‚       Storage           â”‚ â”‚
â”‚  â”‚  (Qwen)     â”‚    â”‚  Provider   â”‚    â”‚                         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ OpenAI API  â”‚    â”‚ â€¢ Polly     â”‚    â”‚ â€¢ Local (dev)           â”‚ â”‚
â”‚  â”‚ í˜¸í™˜        â”‚    â”‚ â€¢ GCP TTS   â”‚    â”‚ â€¢ S3/MinIO (prod)       â”‚ â”‚
â”‚  â”‚             â”‚    â”‚ â€¢ gTTS      â”‚    â”‚                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                  â”‚                       â”‚               â”‚
â”‚         â–¼                  â–¼                       â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Backend (Spring)                          â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚  â”‚  GET  /internal/scripts/{id}/render-spec  â—„â”€â”€ ë Œë” ìŠ¤í™ ì¡°íšŒ  â”‚ â”‚
â”‚  â”‚  POST /video/script/complete              â—„â”€â”€ ìŠ¤í¬ë¦½íŠ¸ ì™„ë£Œ   â”‚ â”‚
â”‚  â”‚  POST /video/job/{id}/complete            â—„â”€â”€ ë Œë”ë§ ì™„ë£Œ     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 LLM Client

**ìœ„ì¹˜**: `app/clients/llm_client.py`

| ì„¤ì •        | ê°’                                    |
| ----------- | ------------------------------------- |
| API         | OpenAI-compatible                     |
| Model       | `meta-llama/Meta-Llama-3-8B-Instruct` |
| Temperature | 0.3                                   |
| Max Tokens  | 4096                                  |
| Timeout     | 30ì´ˆ                                  |
| Retry       | 1íšŒ                                   |

### 5.3 TTS Provider

**ìœ„ì¹˜**: `app/clients/tts_provider.py`

| Provider | í™˜ê²½ë³€ìˆ˜             | ìŒì„±            | ë¹„ê³           |
| -------- | -------------------- | --------------- | ------------- |
| `mock`   | `TTS_PROVIDER=mock`  | -               | í…ŒìŠ¤íŠ¸ìš© ë¬´ìŒ |
| `gtts`   | `TTS_PROVIDER=gtts`  | Google TTS      | ë¬´ë£Œ          |
| `polly`  | `TTS_PROVIDER=polly` | Seoyeon (KR)    | AWS           |
| `gcp`    | `TTS_PROVIDER=gcp`   | ko-KR-Wavenet-A | Google Cloud  |

### 5.4 Storage Adapter

**ìœ„ì¹˜**: `app/clients/storage_adapter.py`

| Provider            | í™˜ê²½ë³€ìˆ˜                             | ìš©ë„            |
| ------------------- | ------------------------------------ | --------------- |
| `local`             | `STORAGE_PROVIDER=local`             | ê°œë°œìš©          |
| `s3`                | `STORAGE_PROVIDER=s3`                | ìš´ì˜ìš© (AWS S3) |
| `backend_presigned` | `STORAGE_PROVIDER=backend_presigned` | ë°±ì—”ë“œ ìœ„ì„     |

### 5.5 Backend Client

**ìœ„ì¹˜**: `app/clients/backend_client.py`

**Integration Points**:

1. **Render Spec ì¡°íšŒ** (Phase 38):

   - `GET /internal/scripts/{script_id}/render-spec`
   - RenderSpec ìŠ¤ëƒ…ìƒ· ë°˜í™˜

2. **Script ì™„ë£Œ ì½œë°±**:

   - `POST /video/script/complete`
   - Payload: `{ material_id, script_id, script, version }`

3. **Job ì™„ë£Œ ì½œë°±**:
   - `POST /video/job/{job_id}/complete`
   - Payload: `{ jobId, videoUrl, duration, status }`

---

## 6. API ì—”ë“œí¬ì¸íŠ¸ ë° ìš”ì²­ íë¦„

### 6.1 Script Generation Flow

```
POST /api/videos/{video_id}/scripts/generate
â”œâ”€ Input: ScriptGenerateRequest
â”‚   â”œâ”€ source_text (êµìœ¡ ì›ë¬¸)
â”‚   â”œâ”€ language (ê¸°ë³¸: ko)
â”‚   â”œâ”€ target_minutes (ê¸°ë³¸: 3)
â”‚   â”œâ”€ max_chapters (ê¸°ë³¸: 5)
â”‚   â”œâ”€ max_scenes_per_chapter (ê¸°ë³¸: 6)
â”‚   â””â”€ style (ê¸°ë³¸: friendly_security_training)
â”‚
â”œâ”€ VideoScriptGenerationService.generate_script()
â”‚  â””â”€ LLMClient.generate_chat_completion() â†’ raw_json
â”‚
â”œâ”€ Service.create_script() â†’ VideoScript (DRAFT status)
â”‚
â”œâ”€ [Async] _notify_script_complete() â†’ Backend callback
â”‚
â””â”€ Response: ScriptGenerateResponse { script_id, status, raw_json }
```

### 6.2 Render Job Creation Flow

```
POST /api/videos/{video_id}/render-jobs
â”œâ”€ Input: Script must be APPROVED
â”‚
â”œâ”€ RenderJobRunner.create_job()
â”‚  â”œâ”€ Check: No PROCESSING/QUEUED job exists (idempotency)
â”‚  â”œâ”€ Create: RenderJobEntity { status: QUEUED }
â”‚  â””â”€ Save to DB
â”‚
â”œâ”€ [Background] _execute_job() or _execute_job_with_spec()
â”‚  â””â”€ Pipeline steps 1-7 executed sequentially
â”‚
â””â”€ Response: RenderJobCreateResponseV2 { job_id, status, created }
```

### 6.3 Job Start & Retry (Phase 38)

```
POST /video/job/{job_id}/start (Backend â†’ AI)
â”œâ”€ RenderJobRunner.start_job()
â”‚  â”œâ”€ Fetch render-spec from backend (cached in DB)
â”‚  â”œâ”€ Validate & normalize spec
â”‚  â”œâ”€ Store snapshot in render_spec_json
â”‚  â””â”€ Start _execute_job_with_spec()
â”‚
â””â”€ Response: JobStartResult { job, started, error_code }

POST /video/job/{job_id}/retry (Backend â†’ AI)
â”œâ”€ RenderJobRunner.retry_job()
â”‚  â”œâ”€ Use existing render_spec_json snapshot
â”‚  â”œâ”€ Reset job status to QUEUED
â”‚  â””â”€ Start _execute_job_with_spec()
â”‚
â””â”€ Response: JobStartResult { job, started }
```

---

## 7. WebSocket ì‹¤ì‹œê°„ ì§„í–‰ë¥ 

### 7.1 ì—°ê²° ë° ì´ë²¤íŠ¸

```
WS /ws/videos/{video_id}/render-progress
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       RenderProgressEvent               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  {                                      â”‚
â”‚    job_id: "uuid",                      â”‚
â”‚    video_id: "uuid",                    â”‚
â”‚    status: "PROCESSING",                â”‚
â”‚    step: "GENERATE_TTS",                â”‚
â”‚    progress: 45,          â—„â”€â”€ 0~100%    â”‚
â”‚    message: "TTS ìƒì„± ì¤‘...",            â”‚
â”‚    timestamp: "2025-12-23T..."          â”‚
â”‚  }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    RenderProgressConnectionManager
    â””â”€ video_id êµ¬ë…ìì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
```

### 7.2 Progress ë‹¨ê³„ë³„ ë²”ìœ„

| Step              | ì‹œì‘ | ì¢…ë£Œ | ë©”ì‹œì§€                |
| ----------------- | ---- | ---- | --------------------- |
| VALIDATE_SCRIPT   | 0%   | 15%  | ìŠ¤í¬ë¦½íŠ¸ ê²€ì¦ ì¤‘...   |
| GENERATE_TTS      | 15%  | 40%  | TTS ìƒì„± ì¤‘...        |
| GENERATE_SUBTITLE | 40%  | 50%  | ìë§‰ ìƒì„± ì¤‘...       |
| RENDER_SLIDES     | 50%  | 60%  | ìŠ¬ë¼ì´ë“œ ë Œë”ë§ ì¤‘... |
| COMPOSE_VIDEO     | 60%  | 85%  | ì˜ìƒ í•©ì„± ì¤‘...       |
| UPLOAD_ASSETS     | 85%  | 95%  | ì—ì…‹ ì—…ë¡œë“œ ì¤‘...     |
| FINALIZE          | 95%  | 100% | ì™„ë£Œ ì²˜ë¦¬ ì¤‘...       |

---

## 8. ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬

### 8.1 Script Generation ì—ëŸ¬

- **Max retries**: 2 (initial + 1 fix attempt)
- **ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤**:
  - JSON parse errors â†’ Fix prompt ì¬ì‹œë„
  - Validation errors â†’ ìŠ¤í‚¤ë§ˆ ë¦¬ë§ˆì¸ë”ë¡œ ì¬ì‹œë„
  - Empty LLM output â†’ ValueError
- **Status code**: 422 UNPROCESSABLE_ENTITY

### 8.2 Rendering ì—ëŸ¬

| Error Code              | ì›ì¸           | ì²˜ë¦¬           |
| ----------------------- | -------------- | -------------- |
| `STORAGE_UPLOAD_FAILED` | S3 ì—…ë¡œë“œ ì‹¤íŒ¨ | ì„ì‹œ íŒŒì¼ ì •ë¦¬ |
| `CANCELED`              | ì‚¬ìš©ì ì·¨ì†Œ    | Task.cancel()  |
| `NO_RENDER_SPEC`        | ìŠ¤í™ ì—†ìŒ      | FAILED ìƒíƒœ    |
| `JOB_NOT_FOUND`         | Job ì—†ìŒ       | 404 ë°˜í™˜       |

### 8.3 Task ì·¨ì†Œ

- ê° íŒŒì´í”„ë¼ì¸ ë‹¨ê³„ì—ì„œ ì·¨ì†Œ ì—¬ë¶€ ëª¨ë‹ˆí„°ë§
- `cancel_job()` í˜¸ì¶œ ì‹œ:
  1. DB ìƒíƒœ â†’ FAILED + error_code="CANCELED"
  2. asyncio.Task.cancel()
  3. ì„ì‹œ íŒŒì¼ ì •ë¦¬

---

## 9. í™˜ê²½ ì„¤ì •

### 9.1 Script Generation

| í™˜ê²½ë³€ìˆ˜         | ì„¤ëª…           | ê¸°ë³¸ê°’                                |
| ---------------- | -------------- | ------------------------------------- |
| `LLM_BASE_URL`   | LLM ì„œë²„ URL   | -                                     |
| `LLM_MODEL_NAME` | ëª¨ë¸ëª…         | `meta-llama/Meta-Llama-3-8B-Instruct` |
| `AI_ENV`         | mock/real ëª¨ë“œ | `mock`                                |

### 9.2 Video Rendering

| í™˜ê²½ë³€ìˆ˜              | ì„¤ëª…                 | ê¸°ë³¸ê°’           |
| --------------------- | -------------------- | ---------------- |
| `TTS_PROVIDER`        | TTS ì œê³µì           | `mock`           |
| `RENDER_OUTPUT_DIR`   | ë Œë”ë§ ì¶œë ¥ ë””ë ‰í† ë¦¬ | `./video_output` |
| `VIDEO_VISUAL_STYLE`  | basic/animated       | `basic`          |
| `VIDEO_WIDTH`         | ì˜ìƒ ë„ˆë¹„            | `1280`           |
| `VIDEO_HEIGHT`        | ì˜ìƒ ë†’ì´            | `720`            |
| `VIDEO_FPS`           | í”„ë ˆì„ë ˆì´íŠ¸         | `24`             |
| `VIDEO_FADE_DURATION` | Fade ì „í™˜ ì‹œê°„ (ì´ˆ)  | `0.5`            |
| `VIDEO_KENBURNS_ZOOM` | Ken Burns ì¤Œ ë¹„ìœ¨    | `1.1`            |

### 9.3 Storage

| í™˜ê²½ë³€ìˆ˜                  | ì„¤ëª…                | ê¸°ë³¸ê°’           |
| ------------------------- | ------------------- | ---------------- |
| `STORAGE_PROVIDER`        | ì €ì¥ì†Œ íƒ€ì…         | `local`          |
| `STORAGE_LOCAL_DIR`       | ë¡œì»¬ ì €ì¥ ê²½ë¡œ      | `./data/assets`  |
| `STORAGE_PUBLIC_BASE_URL` | í¼ë¸”ë¦­ URL ê¸°ë³¸ê²½ë¡œ | `/assets`        |
| `AWS_S3_BUCKET`           | S3 ë²„í‚·ëª…           | -                |
| `AWS_S3_REGION`           | S3 ë¦¬ì „             | `ap-northeast-2` |
| `S3_ENDPOINT_URL`         | MinIO ì—”ë“œí¬ì¸íŠ¸    | -                |

### 9.4 Backend Integration

| í™˜ê²½ë³€ìˆ˜                 | ì„¤ëª…              | ê¸°ë³¸ê°’ |
| ------------------------ | ----------------- | ------ |
| `BACKEND_BASE_URL`       | ë°±ì—”ë“œ ì„œë²„ URL   | -      |
| `BACKEND_API_TOKEN`      | API ì¸ì¦ í† í°     | -      |
| `BACKEND_INTERNAL_TOKEN` | Internal API í† í° | -      |
| `BACKEND_TIMEOUT_SEC`    | ìš”ì²­ íƒ€ì„ì•„ì›ƒ     | `30`   |

---

## 10. ì£¼ìš” íŒŒì¼ ìœ„ì¹˜

| ì—­í•                 | íŒŒì¼ ê²½ë¡œ                                         |
| ------------------- | ------------------------------------------------- |
| ìŠ¤í¬ë¦½íŠ¸ ìƒì„±       | `app/services/video_script_generation_service.py` |
| LLM í´ë¼ì´ì–¸íŠ¸      | `app/clients/llm_client.py`                       |
| ë Œë” Job ê´€ë¦¬       | `app/services/render_job_runner.py`               |
| ì‹¤ì œ ë Œë”ëŸ¬         | `app/services/video_renderer_real.py`             |
| ë¹„ë””ì˜¤ í•©ì„±         | `app/services/video_composer.py`                  |
| TTS ì œê³µì          | `app/clients/tts_provider.py`                     |
| ìŠ¤í† ë¦¬ì§€            | `app/clients/storage_adapter.py`                  |
| ë°±ì—”ë“œ í†µì‹          | `app/clients/backend_client.py`                   |
| API ì—”ë“œí¬ì¸íŠ¸ (v1) | `app/api/v1/videos.py`                            |
| API ì—”ë“œí¬ì¸íŠ¸ (v2) | `app/api/v2/videos.py`                            |
| WebSocket           | `app/api/v1/ws_render_progress.py`                |
| Render Spec ëª¨ë¸    | `app/models/render_spec.py`                       |
| Video Render ëª¨ë¸   | `app/models/video_render.py`                      |
| ì„¤ì •                | `app/core/config.py`                              |

---

## ë¶€ë¡: ê¸°ìˆ ì  ê²°ì • ì‚¬í•­

### A.1 Async/Await íŒ¨í„´

- ëª¨ë“  I/O ì‘ì—… (TTS, FFmpeg, Storage, LLM)ì€ async
- Job ì‹¤í–‰ì€ background asyncio.Task
- WebSocket ì•Œë¦¼ì€ non-blocking

### A.2 Idempotency & Job ì¤‘ë³µ ë°©ì§€

- `create_job()`: ê¸°ì¡´ PROCESSING/QUEUED job ë°˜í™˜
- DB íŠ¸ëœì­ì…˜ìœ¼ë¡œ thread-safety ë³´ì¥

### A.3 Snapshot ê¸°ë°˜ ë Œë”ë§ (Phase 38)

- `render_spec_json`ì„ DBì— ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì €ì¥
- ë°±ì—”ë“œ ìƒíƒœ ë³€ê²½ê³¼ ë Œë”ë§ ë¶„ë¦¬
- ë™ì¼ ìŠ¤í™ìœ¼ë¡œ ì¬ì‹œë„ ê°€ëŠ¥

### A.4 Multi-modal Storage

- ë¡œì»¬/S3/MinIO ì „í™˜ ê°€ëŠ¥
- í™˜ê²½ë³€ìˆ˜ë¡œ provider ì„ íƒ
- ì¶”ìƒí™” ë ˆì´ì–´ë¡œ ì½”ë“œ ë³€ê²½ ìµœì†Œí™”

---

_ì´ ë¬¸ì„œëŠ” ì‹¤ì œ ì½”ë“œ ë¶„ì„ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤._
