# AI 개발팀 회의록 - 2025년 12월 24일

> **회의 일자**: 2025-12-24
> **작성일**: 2025-12-30
> **작성자**: Claude Code

---

## 1. 회의 개요

12월 24일은 인프라 연동 개선 및 보안 강화 작업이 진행된 날입니다. S3 presigned URL 방식 전환, LLM/임베딩 서버 분리, 보안 취약점 수정 등 핵심 인프라 작업이 완료되었습니다.

---

## 2. 작업 내역

### 2.1 S3 Presigned URL 방식 전환

#### 2.1.1 배경

기존 boto3를 사용한 직접 S3 다운로드 방식에서 백엔드 API를 통한 presigned URL 방식으로 변경이 필요했습니다.

| 항목          | 기존 방식             | 변경 후                            |
| ------------- | --------------------- | ---------------------------------- |
| 다운로드 방법 | boto3 직접 다운로드   | 백엔드 API 통해 presigned URL 획득 |
| AWS 자격증명  | AI 서버에서 필요      | 불필요 (인프라 서비스에서 관리)    |
| 메서드        | `_download_from_s3()` | `_get_presigned_url()`             |

#### 2.1.2 구현 상세

**수정 파일**: `app/services/source_set_orchestrator.py`

```python
# 기존: boto3 직접 다운로드
async def _download_from_s3(self, s3_uri: str) -> bytes:
    s3_client = boto3.client('s3')
    ...

# 변경: Presigned URL 방식
async def _get_presigned_url(self, s3_uri: str) -> str:
    """백엔드 /internal/s3/download API 호출하여 presigned URL 반환"""
    ...
```

**설정 추가** (`app/core/config.py`):

```python
BACKEND_BASE_URL: str = ""  # 인프라 서비스 URL
```

**API 엔드포인트 변경**:

- `/internal/s3/download` → `/infra/files/presign/download`

#### 2.1.3 관련 커밋

| 커밋      | 내용                                                                     |
| --------- | ------------------------------------------------------------------------ |
| `2bd5af3` | S3 URI 처리를 presigned URL 방식으로 변경                                |
| `803d039` | S3 presigned URL 요청을 infra-service로 변경, BACKEND_BASE_URL 설정 추가 |
| `540832c` | S3 URI (s3://) 다운로드 지원 추가                                        |
| `bb0f241` | source_url null 체크 추가                                                |

---

### 2.2 LLM과 임베딩 서버 URL 분리

#### 2.2.1 배경

기존에는 LLM과 임베딩 서비스가 동일한 URL을 사용했으나, 인프라 구성 변경으로 인해 서버 분리가 필요했습니다.

| 서비스 | 기존             | 변경 후                          |
| ------ | ---------------- | -------------------------------- |
| LLM    | 포트 1237        | `LLM_BASE_URL` (포트 1237)       |
| 임베딩 | 포트 1237 (동일) | `EMBEDDING_BASE_URL` (포트 1234) |

#### 2.2.2 구현 상세

**설정 추가** (`app/core/config.py`):

```python
EMBEDDING_BASE_URL: str = ""  # 임베딩 서버 URL (LLM과 분리)
```

**수정 파일**: `app/clients/milvus_client.py`

- 임베딩 요청 시 `EMBEDDING_BASE_URL` 사용하도록 변경

#### 2.2.3 관련 커밋

| 커밋      | 내용                                                     |
| --------- | -------------------------------------------------------- |
| `db25e9b` | LLM과 임베딩 서버 URL 분리, EMBEDDING_BASE_URL 설정 추가 |

---

### 2.3 보안 취약점 수정

#### 2.3.1 내부 IP 주소 노출 문제

문서에 포함된 실제 서버 IP 주소를 플레이스홀더 값으로 교체했습니다.

**조치 내용**:

- 실제 IP 주소 → `xxx.xxx.xxx.xxx` 또는 환경변수 참조로 변경
- README.md 및 각종 설정 가이드 문서 수정

#### 2.3.2 관련 커밋

| 커밋      | 내용                                                 |
| --------- | ---------------------------------------------------- |
| `c2391f2` | 문서에서 내부 IP 주소 제거, 플레이스홀더 값으로 대체 |

---

## 3. 환경 설정 변경 사항

### 3.1 신규 환경변수

| 환경변수             | 설명              | 예시                        |
| -------------------- | ----------------- | --------------------------- |
| `BACKEND_BASE_URL`   | 인프라 서비스 URL | `http://infra-service:8080` |
| `EMBEDDING_BASE_URL` | 임베딩 서버 URL   | `http://embedding:1234`     |

### 3.2 .env 파일 예시 업데이트

```bash
# 기존 설정
LLM_BASE_URL=http://llm-server:1237

# 신규 추가 (12/24)
BACKEND_BASE_URL=http://infra-service:8080
EMBEDDING_BASE_URL=http://embedding-server:1234
```

---

## 4. 의존성 변경

### 4.1 제거된 의존성

| 패키지  | 이유                                                   |
| ------- | ------------------------------------------------------ |
| `boto3` | S3 presigned URL 방식으로 변경하여 직접 AWS SDK 불필요 |

### 4.2 장점

1. **보안 강화**: AI 서버에 AWS 자격증명 저장 불필요
2. **권한 분리**: S3 접근 권한을 인프라 서비스로 일원화
3. **유연성**: 인프라 서비스에서 presigned URL 만료 시간 등 제어 가능

---

## 5. 테스트 현황

| 항목                  | 상태           |
| --------------------- | -------------- |
| S3 presigned URL 통합 | 정상 동작 확인 |
| LLM/임베딩 분리       | 정상 동작 확인 |
| 기존 테스트           | 전체 통과      |

---

## 6. 아키텍처 변경 다이어그램

### 6.1 S3 접근 흐름 변경

**Before (12/24 이전)**:

```
┌─────────────┐     ┌───────────────┐     ┌─────────────┐
│   AI 서버   │────▶│     boto3     │────▶│     S3      │
│             │     │ (직접 다운로드) │     │             │
└─────────────┘     └───────────────┘     └─────────────┘
      ▲
      │ AWS Credentials 필요
```

**After (12/24 이후)**:

```
┌─────────────┐     ┌───────────────┐     ┌─────────────┐
│   AI 서버   │────▶│ Infra Service │────▶│     S3      │
│             │     │ (presigned URL│     │             │
└─────────────┘     │  발급)        │     └─────────────┘
                    └───────────────┘
      ▲                    ▲
      │ AWS Credentials    │ AWS Credentials
      │ 불필요             │ 관리
```

### 6.2 LLM/임베딩 서버 분리

**Before**:

```
┌─────────────┐
│  LLM 서버   │◀──── LLM 요청 + 임베딩 요청
│  (포트 1237) │
└─────────────┘
```

**After**:

```
┌─────────────┐
│  LLM 서버   │◀──── LLM 요청 (chat/completions)
│  (포트 1237) │
└─────────────┘

┌─────────────┐
│ 임베딩 서버  │◀──── 임베딩 요청 (embeddings)
│  (포트 1234) │
└─────────────┘
```

---

## 7. 참고 사항

### 7.1 백엔드팀 협업 필요 사항

| 항목                                              | 상태      | 비고 |
| ------------------------------------------------- | --------- | ---- |
| Infra Service `/infra/files/presign/download` API | 연동 완료 | -    |
| S3 presigned URL 발급                             | 정상 동작 | -    |
| URL trailing slash 처리                           | 적용됨    | -    |

### 7.2 주의사항

1. `BACKEND_BASE_URL` 설정 시 trailing slash 없이 설정
2. presigned URL 만료 시간 고려 (기본값 확인 필요)
3. 네트워크 격리 환경에서 infra-service 접근 가능 여부 확인

---

## 8. 다음 작업 예정

| 우선순위 | 작업 항목                        | 담당 |
| -------- | -------------------------------- | ---- |
| 높음     | Option 3 Milvus 통합             | AI팀 |
| 높음     | FAQ 서비스 Milvus 직접 검색 연동 | AI팀 |
| 중간     | 성능 개선 Phase 45/46 구현       | AI팀 |

---

## 9. 파일 변경 요약

| 파일                                      | 변경 내용                                                   |
| ----------------------------------------- | ----------------------------------------------------------- |
| `app/core/config.py`                      | BACKEND_BASE_URL, EMBEDDING_BASE_URL 추가                   |
| `app/services/source_set_orchestrator.py` | \_get_presigned_url() 메서드 추가, boto3 직접 다운로드 제거 |
| `app/clients/milvus_client.py`            | 임베딩용 URL 분리 적용                                      |
| `docs/*.md`                               | 내부 IP 주소 제거                                           |

---

**회의록 종료**
