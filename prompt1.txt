⚠️ 확인된 이슈 & 바로 적용 가능한 조치
A) 나레이션이 영어로 나오는 문제 (우선순위: 높음)
원인: 현재 모델이 한국어보다 영어로 “안전하게” 출력하는 경향
내일 모델 교체 전, 오늘 바로 넣을 수 있는 임시방편(안전한 것만):

Outline/Scene 프롬프트 둘 다에 강제 문구 삽입

“모든 필드(narration/caption/visual)는 반드시 한국어”

“영어 단어/문장 포함 시 실패로 간주”

출력 검증(Validation) 추가

narration에 한글 비율이 일정 기준 미만이면 같은 입력으로 1회 재시도(temperature 더 낮게)

재시도에도 실패하면 FAILED로 명확히 처리(조용히 통과시키지 않기)

내일 모델 교체(EXAONE/Bllossom 등) 후에도 이 “출력 언어 검증”은 남겨두는 게 운영에 좋아.

B) Windows 콘솔 한글 파일명 깨짐 (우선순위: 중간)
증상: 테스트 출력 로그에서 doc_id가 깨져 보임
조치(운영/개발 편의):

PowerShell(권장)

chcp 65001

$env:PYTHONUTF8="1"

Python 로깅/파일 입출력 시 UTF-8 명시(이미 하고 있다면 OK)

“실제 Milvus 검색/업서트에는 영향 없음”이라도, 로그가 깨지면 디버깅 난이도가 급상승해서 개발 경험 측면에서 개선 추천.

C) “Potentially unsafe doc_id, escaping” 로그 (우선순위: 중간~높음)
이건 보안적으로 좋은 경고야. 다만 doc_id가 바뀌면 추적/재현이 어려워질 수 있음.
권장 패턴

내부 식별자는 safe_doc_id = sha256(original_doc_id) 같은 안전한 고정 ID로 통일

원본 파일명(original)은 메타 필드로만 저장(표시/다운로드용)

🚀 다음 스텝 체크리스트 (바로 진행하면 “완성도”가 확 올라감)
1) 품질 개선(가장 체감 큼)
 (Optional) 3단계 Polish를 “전체 1회”가 아니라 **씬별 폴리시(N회)**로 설계

이유: 전체를 한 번에 넣으면 다시 컨텍스트가 커지고, 폴리시 실패 시 영향 범위가 큼

 씬별로 style_guide를 고정값으로 넣고, “용어집(금지/권장 표현)”을 짧게 추가

2) 성능/비용 제어
 씬 생성 동시성 Semaphore=3~5 유지(이미 했으면 OK)

 Top-K(현재 3) + chunk 길이 제한(문자/토큰) 값을 환경변수로 튜닝 가능하게 고정

 캐시: 동일 씬 쿼리의 검색 결과(hits)를 메모리 캐시(테스트에서 특히 효과)

3) 운영 관측(나중에 문제 터졌을 때 살길)
 단계별 타이밍: outline_ms / retrieve_ms / scene_llm_ms / total_ms

 씬별 입력 크기(청크 수, 잘린 길이), 출력 길이, 언어검증 통과 여부

 실패 시 fail_reason 표준화 (예: OUTLINE_PARSE_ERROR, RETRIEVE_EMPTY, NON_KOREAN_OUTPUT)

✅ 지금 상태의 “결론 한 줄”
기능(생성/검색/콜백)은 이미 합격, 이제는 한국어 출력 강제 + ID 안정화 + 관측/튜닝 포인트만 잡으면 “발표/운영 가능한 품질”로 올라간다.